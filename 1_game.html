<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <title>12-3-1</title>
    <style>
        * {
            margin: 0px;
        }

        p {
            text-align: center;
        }

        #canvas1 {
            border: 1px solid gray;
        }
    </style>
</head>

<body>
    <p>
        <canvas id="canvas1" width="320" height="480"></canvas>
    </p>
    <script>
        const canvas1 = document.getElementById("canvas1");
        const ctx1 = canvas1.getContext("2d");

        //①変数の設定と初期化
        const target = { x: 250, y: 100, width: 10, height: 10, dir: 1 };
        const player = { x: 250, y: 400, width: 50, height: 10 };
        const ball = { x: -10, y: -10, width: 10, height: 10, active: false };
        const ballSpeed = 10;   //ボールのスピード
        let point = 0;

        //②一定時間ごとにプログラムgame1を起動させる
        setInterval(game1, 50);

        //③game1関数
        function game1() {
            //画面をクリア
            ctx1.clearRect(0, 0, 320, 480);

            //描画(ゲーゲット)
            ctx1.fillStyle = "black";
            ctx1.fillRect(target.x - target.width / 2, target.y - target.height / 2, target.width, target.height);

            //描画(得点)
            ctx1.fillStyle = "black";
            ctx1.font = "20px sans-serif";
            ctx1.fillText("SCORE:" + String(point).padStart(7, '0'), 120, 20);//スコア表示は0埋め表示

            //描画(プレーヤ)
            ctx1.fillStyle = "blue";
            ctx1.fillRect(player.x - player.width / 2, player.y - player.height / 2, player.width, player.height);

            //描画(ボール)
            ctx1.fillStyle = "red";
            ctx1.fillRect(ball.x - ball.width / 2, ball.y - ball.height / 2, ball.width, ball.height);

            //移動計算
            target.x += target.dir;
            ball.y -= ballSpeed;

            //壁衝突計算
            if (target.x < 25 || 295 < target.x) {
                target.dir *= -1;
            }

            //ボールが画面外に出た時
            if (ball.y <= -10) {
                ballInit();
            }

            //得点計算
            if (collision(ball, target)) {
                ballInit();
                point++;
            }
        }

        //④shoot関数
        canvas1.addEventListener("mousedown", function () {
            if (!ball.active) {    //ボールが発射されてないときボールが撃てる
                ball.active = true
                ball.x = player.x;
                ball.y = player.y;
            }
        });

        //⑤プレーヤコントロール
        canvas1.addEventListener("mousemove", function (e) {
            const rect = e.target.getBoundingClientRect();
            player.x = e.clientX - rect.left;
            // player.y = e.clientY;//当たり判定デバッグ用
        });

        //当たり判定
        function collision(rectA, rectB) {
            const Ax1 = rectA.x - rectA.width / 2
            const Ay1 = rectA.y - rectA.height / 2
            const Ax2 = rectA.x + rectA.width / 2
            const Ay2 = rectA.y + rectA.height / 2

            const Bx1 = rectB.x - rectB.width / 2
            const By1 = rectB.y - rectB.height / 2
            const Bx2 = rectB.x + rectB.width / 2
            const By2 = rectB.y + rectB.height / 2

            //矩形が当たってない条件
            const noCollision = Ax2 < Bx1 || Ax1 > Bx2 || Ay2 < By1 || Ay1 > By2
            //当たってないの否定を返す(当たり判定)
            return !noCollision
        }

        //ボール位置初期化
        function ballInit() {
            ball.active = false
            ball.x = -10;
            ball.y = -10;
        }
    </script>
</body>

</html>